<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>$ make now just</title><link rel="stylesheet" href="https://makenowjust.github.io/diary/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css"></head><body><header><h1><a href="https://makenowjust.github.io/diary/">$ make now just</a></h1></header><main><article><div class="article-header"><div class="time"><time pubdate datetime="2017-03-25T00:00:00+00:00">2017/03/25</time></div><h1>Quineを書いたりFlateを直したりした</h1></div><div class="article-content"><script async src="//cdn.embedly.com/widgets/platform.js"></script>
<h1>やったこと</h1>
<h2>DafnyでQuineを書いた</h2>
<p>DafnyというMicrosoftが作っている正当性の検証のできるプログラミング言語があるらしい。</p>
<p><a class="embedly-card" href="https://www.microsoft.com/en-us/research/project/dafny-a-language-and-program-verifier-for-functional-correctness/">Dafny: A Language and Program Verifier for Functional Correctness - Microsoft Research</a></p>
<p>バックエンドにBoogieとz3を使って検証するらしい。形式手法というのだろうか？　ともかくz3がつよいということが分かる言語だった。</p>
<p>多分、C#とかに比較的近い構文で形式手法ができることに価値があるのではないかと思う。</p>
<p>Quineはこれ。</p>
<p><a class="embedly-card" href="https://github.com/MakeNowJust/quine/blob/55ac3a8393bf1d41225d7018b4cb817a381b99ed/quine.dfy">quine/quine.dfy at 55ac3a8393bf1d41225d7018b4cb817a381b99ed · MakeNowJust/quine</a></p>
<p>せっかくなので<code>Quote</code>メソッドで返される文字列が引数の文字列の長さの二倍より二大きくなっているか検証している。Quineかどうかの検証というのは中々難しい。というかできるんだろうか‥‥。</p>
<p>実行方法は、</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> dafny quine.dfy</span>
Dafny program verifier version 1.9.7.30401, Copyright (c) 2003-2016, Microsoft.

Dafny program verifier finished with 4 verified, 0 errors
Compiled assembly into quine.exe
<span class="hljs-meta">$</span><span class="bash"> mono quine.exe | diff quine.dfy -</span>
</code></pre>
<p>みたいな感じでいいと思います。ちなみに改行の大きさを1に仮定してるのでrise4funのオンラインで実行できるやつだと上手く動きません。</p>
<p>これの地味にしんどかったところは、文字列の長さが<code>100</code>より大きくなることを要求すると問答無用で検証に失敗するところ。要するに<code>requires |s| > 100</code>みたいなのがあるとダメ。なので文字列の長さから引いた位置から部分文字列を取り出すようにしてる。これだと上手くいく。完全に謎。</p>
<h2>JamでQuineを書いた</h2>
<p>これは一週間前のことなんだけど実行方法をメモっておかないと忘れそうなので。</p>
<p>Jamというビルドシステムがある。Boostのビルドで使われるのでこれで有名かもしれない。</p>
<p>このビルドの定義用の言語でQuineを書いた。</p>
<p><a class="embedly-card" href="https://github.com/MakeNowJust/quine/blob/88becc31080ade377a0c9416b5e4c040af9394cd/quine.jam">quine/quine.jam at 88becc31080ade377a0c9416b5e4c040af9394cd · MakeNowJust/quine</a></p>
<p>で、これはJamでこう実行できる。</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> jam -d0 -f quine.jam | diff quine.jam -</span>
</code></pre>
<p>ちなみに、これはBoost.Jamだと上手く動かない。というのもオリジナルのJamだと出力の末尾にスペースが入るのだけど、Boost.Jamだとそれがないから。なのでファイルの最後のスペースを消せばQuineになるはず。どう考えてもオリジナルのJamが悪いのだけど、されどオリジナルなので許容することにした。Boost.Jamも方言扱いして別のQuine書こうかとも思ったのだけど、これ以外に何が違うのかよく分かっていないので手を付けていない。</p>
<h2>Flateを直した</h2>
<p><a class="embedly-card" href="https://github.com/crystal-lang/crystal/pull/4193">Flate: try to inflate even if @stream.avail_in is 0 by MakeNowJust · Pull Request #4193 · crystal-lang/crystal</a></p>
<p>なんかがんばったら直った。zlibよく分からないしちゃんと理解したい。</p></div><div class="article-footer"><div class="author">written by <a href="https://github.com/MakeNowJust">TSUYUSATO "MakeNowJust" Kitsune</a></div></div><div id="disqus_thread"><script>//<![CDATA[
(function () {
  window.disqus_config = function () {
    var e = document.getElementById('disqus_thread')
    this.page.url = e.getAttribute('data-url')
    this.page.identifier = e.getAttribute('data-identifier')
  }

  var d = document, s = d.createElement('script'), t = d.head || d.body
  s.src = '//make-now-just.disqus.com/embed.js'
  s.setAttribute('data-timestamp', Date.now())
  t.appendChild(s)
})()
//]]></script></div></article></main><footer><small>&copy; 2016-2017 TSUYUSATO "MakeNowJust" Kitsune</small></footer></body></html>