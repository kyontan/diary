---
title: バイトをした
---

# やったこと

## バイトをした

しょうもないミスのせいで時間がかかったけど、BFAで実装してしまった。正確にはBFAではない。というかもはや作る言語が正規なのかすらよく分からない。けど動く。なんかすごい。自分はとんでもないものを作り出してしまったのではないかという気がしている。

あとはこれをDFAに変換‥‥できたらいいなぁ。

## [#4801](https://github.com/crystal-lang/crystal/pull/4801)

`{% if ... %} ~ {% end %}`の中で`end`で出てきてもマクロが終了したってことにならないようにする修正。大分前からアイディアはあったのだけど実装が面倒だった。大分めんどくさがったせいで実際の実装はそんなに苦でもなかったのだけど、そのあとにフォーマッタがバグってると言われて直したのがかったるかった。

なんでフォーマッタは`@macro_state`をコントロール間で使い回してるんだよ。そこはパーサーと同じにしておけよ、という感じ。

気合いで直した。多分ちゃんと直ってる。

## [#4805](https://github.com/crystal-lang/crystal/pull/4805)

`crystal tool context`が、呼び出されてないメソッドの中のコンテキストを取得しようとすると例外を投げるので、その辺を直した。ついでにエラーメッセージもそのときだけちょっと変えたものにした。

あと、PRを文面考えているときにともかく眠くて、結果Issueの番号を書き間違えた。そしてなぜか@RX14から瞬時に指摘が飛んできた。そんな指摘はどうでもいいので`unreachable!`の方を反応してほしい。

どうせ放置されるんだろうな‥‥。
