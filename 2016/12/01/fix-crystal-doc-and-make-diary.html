<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>$ make now just</title><link rel="stylesheet" href="https://makenowjust.github.io/diary/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css"></head><body><header><h1><a href="https://makenowjust.github.io/diary/">$ make now just</a></h1></header><main><article><div class="article-header"><div class="time"><time pubdate datetime="2016-12-01T00:00:00+00:00">2016/12/01</time></div><h1>crystal docを直したり日記を作ったりした</h1></div><div class="article-content"><script async src="//cdn.embedly.com/widgets/platform.js"></script>
<h1><code>crystal doc</code>を直した</h1>
<p>Crystalの<code>BitArray</code>のドキュメントにおかしい部分があることに気付いていたので眺めていたら、なんかもっと根本的におかしい部分を見付けたので直していた。
例えば<code>BitArray</code>は<code>Enumerable(Bool)</code>とか<code>Indexable(Bool)</code>を<code>include</code>しているのだけど、これがなぜか<code>Enumerable({"T", T})</code>とか<code>Indexable({"T", T})</code>みたいになる。ジェネリククスを継承してるとおかしくなるっぽい。</p>
<p><img src="https://cloud.githubusercontent.com/assets/6679325/20783654/88fb9edc-b7d8-11e6-841f-a7969e022bb6.png" alt="BitArrayのドキュメントがおかしい"></p>
<p>これは主に、<a href="https://github.com/crystal-lang/crystal/blob/b8602fbd0ce920fc35c2bf3109c636e2798d751c/src/compiler/crystal/tools/doc/type.cr#L59-L60">この行が原因</a>、</p>
<pre><code class="hljs language-crystal">    <span class="hljs-keyword">when</span> GenericInstanceType
      <span class="hljs-keyword">type</span>.type_vars
</code></pre>
<p><code>type.type_vars</code>の型は<code>Hash(String, Crystal::ASTNode)</code>なんだけど、このメソッド（<code>Crystal::Doc::Type#type_vars</code>）は<code>Array(String)?</code>が返ることが期待されてる。それにも関わらずこのメソッドの返り値を使う部分では型にあまり依存しない処理しかされてないから、そのことがコンパイルエラーにならない、という感じ。</p>
<p>ならその行を直せばいいのかというとそんなに事態は単純でもないのだけど‥‥、説明が面倒になったので次の二つのPull Requestを見てほしい。</p>
<ul>
<li><a href="https://github.com/crystal-lang/crystal/pull/3616" class="embedly-card">Fix doc of the type inherited from generics class or module</a></li>
<li><a href="https://github.com/crystal-lang/crystal/pull/3617" class="embedly-card">Fix doc of the type having generic superclass</a></li>
</ul>
<p>よくもまあ似たような名前のPull Requestを作るものだ。</p>
<p>他にも<a href="https://github.com/crystal-lang/crystal/pull/3615"><code>ArrayLiteral#[]=</code>のドキュメントを追加するPull Request</a>を出したりした。</p>
<h1>日記を作った</h1>
<p>上の<code>crystal doc</code>の修正は大体学校でやっていたのだけど、家に帰ってからはずっとこの日記を作っていた。どうしてこんなものを作ったのかというと、昨日ノリと勢いだけで<a href="http://www.adventar.org/calendars/1906">Make Now Just Advent Calendar 2016</a>を作ってしまったので、どこかしらそれを記事を公開していかなければならなくなったからだったりする。</p>
<p><code>gulp</code>とかをどうしても使いたくなかったので車輪の再発明をしまくった気がする。まあ動いてはいる。</p>
<hr>
<p>というわけでこの日記を<a href="http://www.adventar.org/calendars/1906">Make Now Just Advent Calendar 2016</a>の1日目の記事ということにしたいと思います。（雑）</p></div><div class="article-footer"><div class="author">written by <a href="https://github.com/MakeNowJust">TSUYUSATO "MakeNowJust" Kitsune</a></div></div><div id="disqus_thread"><script>//<![CDATA[
(function () {
  window.disqus_config = function () {
    var e = document.getElementById('disqus_thread')
    this.page.url = e.getAttribute('data-url')
    this.page.identifier = e.getAttribute('data-identifier')
  }

  var d = document, s = d.createElement('script'), t = d.head || d.body
  s.src = '//make-now-just.disqus.com/embed.js'
  s.setAttribute('data-timestamp', Date.now())
  t.appendChild(s)
})()
//]]></script></div></article></main><footer><small>&copy; 2016-2017 TSUYUSATO "MakeNowJust" Kitsune</small></footer></body></html>